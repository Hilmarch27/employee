import{e as h,r as j,j as a,B as g,t as f,a as b,L as m,N as v}from"./main-DU4EUtQO.js";import{u as x,g as N,j as S,k as D,l as k,i,m as F,e as T}from"./barcode-fn-DL7I558b.js";import{e as w,D as C,a as E,T as z,C as H}from"./data-table-toolbar-BUORIGi8.js";import"./input-CAae7FRY.js";const M=[["path",{d:"M16 20V4a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16",key:"jecpp"}],["rect",{width:"20",height:"14",x:"2",y:"6",rx:"2",key:"i6l2r4"}]],R=h("briefcase",M);const L=[["path",{d:"M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z",key:"1oefj6"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}],["path",{d:"M8 13h2",key:"yr2amv"}],["path",{d:"M14 13h2",key:"un5t4a"}],["path",{d:"M8 17h2",key:"2yhykz"}],["path",{d:"M14 17h2",key:"10kma7"}]],I=h("file-spreadsheet",L);function K(){return[{id:"no",accessorKey:"no",header:({column:e})=>a.jsx(i,{column:e,title:"No"}),cell:({row:e})=>a.jsx("div",{children:e.index+1}),minSize:40,maxSize:40,enableSorting:!1,enablePinning:!1,enableHiding:!1},{id:"name",accessorKey:"name",header:({column:e})=>a.jsx(i,{column:e,title:"Name"}),cell:({row:e})=>a.jsx("div",{children:e.getValue("name")}),meta:{label:"Name",placeholder:"Search Name...",variant:"text",icon:z},filterFn:D,enableColumnFilter:!0},{id:"position",accessorKey:"position",header:({column:e})=>a.jsx(i,{column:e,title:"Instansi"}),cell:({row:e})=>a.jsx("div",{children:e.getValue("position")}),meta:{label:"Instansi",placeholder:"Search instansi...",variant:"combobox",icon:R},enableColumnFilter:!0},{accessorKey:"badge",header:({column:e})=>a.jsx(i,{column:e,title:"Badge"}),cell:({row:e})=>a.jsx("div",{children:e.getValue("badge")})},{id:"haircutDate",accessorKey:"haircutDate",header:({column:e})=>a.jsx(i,{column:e,title:"Date"}),cell:({row:e})=>{const t=e.getValue("haircutDate");return t instanceof Date&&!Number.isNaN(t.getTime())?a.jsx("div",{children:t.toLocaleDateString("id-ID",{weekday:"long",day:"numeric",month:"long",year:"numeric"})}):a.jsx("div",{children:"-"})},meta:{label:"Haircut Date",placeholder:"Search Haircut Date...",variant:"dateRange",icon:H},filterFn:k,enableColumnFilter:!0,minSize:200,maxSize:200},{accessorKey:"formattedTime",header:({column:e})=>a.jsx(i,{column:e,title:"Time"}),cell:({row:e})=>a.jsx("div",{children:e.getValue("formattedTime")})},{accessorKey:"monthYear",header:({column:e})=>a.jsx(i,{column:e,title:"Month & Year"}),cell:({row:e})=>a.jsx("div",{children:e.getValue("monthYear")})}]}function V({data:e,username:t}){const d=x(w),l=j.useMemo(()=>K(),[]),{table:r}=N({defaultColumn:{minSize:160},data:e,columns:l,getRowId:c=>c.id}),{mutateAsync:p}=S({mutationFn:async()=>{const n=r.getState().columnFilters.find(o=>o.id==="haircutDate");let s;if(n?.value&&Array.isArray(n.value)){const[o,u]=n.value;o&&u&&(s=[o,u])}return await(await d({data:s?{range:s}:void 0})).blob()},onSuccess:c=>{const n=window.URL.createObjectURL(c),s=document.createElement("a");s.href=n,s.download=`haircut-history-${new Date().toISOString()}.xlsx`,s.click(),window.URL.revokeObjectURL(n)}}),y=()=>{f.promise(p(),{loading:"Exporting Excel...",success:"Excel exported successfully",error:"Failed to export Excel"})};return a.jsx("div",{className:"w-full",children:a.jsx(C,{className:"py-3",table:r,children:a.jsx(E,{table:r,children:t==="admin"&&a.jsxs(g,{variant:"outline",size:"sm",className:"h-8",onClick:y,children:["Export Excel",a.jsx(I,{className:"ml-2 h-4 w-4"})]})})})})}function q(){const e=x(F),{data:t,isLoading:d}=T({queryKey:["haircut-history"],queryFn:()=>e()}),{data:l,isPending:r}=b();return r?a.jsx("div",{className:"flex items-center justify-center h-screen",children:a.jsx(m,{className:"size-10 animate-spin"})}):l?d?a.jsx("div",{className:"flex items-center justify-center h-screen",children:a.jsx(m,{className:"size-10 animate-spin"})}):a.jsx(V,{username:l?.user.username||"",data:t?.data||[]}):a.jsx(v,{to:"/signin"})}export{q as component};
