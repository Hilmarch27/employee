import{j as e,c as p,R as S,r as x,u as v,z as f,B as y,t as h,a as N,L as C,N as D}from"./main-DU4EUtQO.js";import{T,a as m,b as z,f as j,c as w,d as g,D as I,u as b,e as F,g as R,h as E,i as d,j as B,s as P}from"./barcode-fn-DL7I558b.js";import{u as V,F as _,a as H,b as K}from"./field-D0GJiKVd.js";import{C as k,a as L,b as M,c as q}from"./card-CHKjLI2G.js";import{I as A}from"./input-CAae7FRY.js";function Q({table:a,onRowClick:t,renderSubComponent:r,showPagination:l=!0,children:c,className:s,...u}){const o=n=>({width:n.getSize()!==150?n.getSize():void 0,position:"sticky",top:0,zIndex:10});return e.jsxs("div",{className:p("w-full space-y-2.5",s),...u,children:[c,e.jsx("div",{className:"rounded-md border max-h-[300px] overflow-hidden",children:e.jsx("div",{className:"overflow-y-auto max-h-[300px]",children:e.jsxs("table",{className:"[&_td]:border-border [&_th]:border-border w-full table-fixed border-separate border-spacing-0 [&_tfoot_td]:border-t [&_th]:border-b [&_tr]:border-none [&_tr:not(:last-child)_td]:border-b",children:[e.jsx(T,{children:a.getHeaderGroups().map(n=>e.jsx(m,{className:"bg-muted/50",children:n.headers.map(i=>e.jsx(z,{colSpan:i.colSpan,className:"h-10 truncate bg-muted/95 backdrop-blur-sm first:rounded-tl-md last:rounded-tr-md",style:{...o(i)},children:i.isPlaceholder?null:j(i.column.columnDef.header,i.getContext())},i.id))},n.id))}),e.jsx(w,{children:a.getRowModel().rows.length?a.getRowModel().rows.map(n=>e.jsxs(S.Fragment,{children:[e.jsx(m,{className:t?"cursor-pointer":"",onClick:()=>t?.(n.original),"data-state":n.getIsSelected()&&"selected",children:n.getVisibleCells().map(i=>e.jsx(g,{className:"truncate",style:{width:i.column.getSize()!==150?i.column.getSize():void 0},children:j(i.column.columnDef.cell,i.getContext())},i.id))}),n.getIsExpanded()&&r&&e.jsx(m,{children:e.jsx(g,{colSpan:n.getVisibleCells().length,children:r({row:n})})})]},`fragment-${n.id}`)):e.jsx(m,{children:e.jsx(g,{colSpan:a.getAllColumns().length,className:"h-24 text-center",children:"No results."})})})]})})}),l&&e.jsx(I,{table:a})]})}function U(){return[{id:"no",accessorKey:"no",header:({column:a})=>e.jsx(d,{column:a,title:"No"}),cell:({row:a})=>e.jsx("div",{children:a.index+1}),minSize:40,maxSize:40,enableSorting:!1,enablePinning:!1,enableHiding:!1},{id:"name",accessorKey:"name",header:({column:a})=>e.jsx(d,{column:a,title:"Name"}),cell:({row:a})=>e.jsx("div",{children:a.getValue("name")})},{id:"position",accessorKey:"position",header:({column:a})=>e.jsx(d,{column:a,title:"Instansi"}),cell:({row:a})=>e.jsx("div",{children:a.getValue("position")}),minSize:250,maxSize:250},{accessorKey:"badge",header:({column:a})=>e.jsx(d,{column:a,title:"Badge"}),cell:({row:a})=>e.jsx("div",{children:a.getValue("badge")}),minSize:250,maxSize:250},{id:"haircutDate",accessorKey:"haircutDate",header:({column:a})=>e.jsx(d,{column:a,title:"Date"}),cell:({row:a})=>{const t=a.getValue("haircutDate");return t instanceof Date&&!Number.isNaN(t.getTime())?e.jsx("div",{children:t.toLocaleDateString("id-ID",{weekday:"long",day:"numeric",month:"long",year:"numeric"})}):e.jsx("div",{children:"-"})},minSize:200,maxSize:200},{accessorKey:"formattedTime",header:({column:a})=>e.jsx(d,{column:a,title:"Time"}),cell:({row:a})=>e.jsx("div",{children:a.getValue("formattedTime")})}]}function O(){const a=b(E),{data:t,isLoading:r}=F({queryKey:["preview-haircut"],queryFn:()=>a()}),l=x.useMemo(()=>U(),[]),{table:c}=R({enableColumnPinning:!1,enableSorting:!1,enableColumnResizing:!1,enableHiding:!1,defaultColumn:{minSize:160},data:t?.data||[],columns:l,getRowId:s=>s.id,initialState:{pagination:{pageIndex:0,pageSize:9999}}});return x.useEffect(()=>{t?.data&&t.data.length>0&&c.setPageSize(t.data.length)},[t?.data,c]),r?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"text-muted-foreground",children:"Loading preview..."})}):e.jsx("div",{className:"w-full",children:e.jsx(Q,{className:"py-3",table:c,showPagination:!1})})}function W(){const a=b(P),t=v(),r=x.useRef(null),l=V({defaultValues:{id:""},validators:{onSubmit:f.object({id:f.string().min(1,"Scan ID tidak boleh kosong")})},onSubmit:async({value:s})=>{h.promise(c({data:s}),{loading:"Scanning..."})}}),{mutateAsync:c}=B({mutationFn:a,onSuccess:s=>{t.invalidateQueries({queryKey:["haircut-history"]}),h.success(s.message),l.reset(),setTimeout(()=>{r.current?.focus()},100)},onError:s=>{h.error(s.message),setTimeout(()=>{r.current?.focus()},100)}});return x.useEffect(()=>{r.current?.focus()},[]),e.jsxs(k,{children:[e.jsx(L,{children:e.jsx(M,{children:"Scan Barcode"})}),e.jsx(q,{children:e.jsxs("form",{onSubmit:s=>{s.preventDefault(),l.handleSubmit()},className:"flex gap-2 items-center w-full",children:[e.jsx("div",{className:"flex-1",children:e.jsx(l.Field,{name:"id",children:s=>{const u=s.state.meta.isTouched&&!s.state.meta.isValid;return e.jsxs(_,{"data-invalid":u,children:[e.jsx(H,{htmlFor:s.name,children:"Instansi"}),e.jsx(A,{ref:r,value:s.state.value,onChange:o=>{s.handleChange(o.target.value)},onKeyDown:o=>{o.key==="Enter"&&s.state.value.trim()&&(o.preventDefault(),l.handleSubmit())},onBlur:()=>{setTimeout(()=>{document.activeElement?.tagName!=="BUTTON"&&r.current?.focus()},100)},autoFocus:!0,placeholder:"Scan ID Barcode..."}),u&&e.jsx(K,{errors:s.state.meta.errors})]})}})}),e.jsx(l.Subscribe,{selector:s=>s.isSubmitting,children:s=>e.jsx(y,{type:"submit",disabled:s,className:"mt-7.5",children:s?"Scanning...":"Scan"})})]})})]})}function Z(){const{data:a,isPending:t}=N();return t?e.jsx("div",{className:"flex items-center justify-center h-screen",children:e.jsx(C,{className:"size-10 animate-spin"})}):a?e.jsxs("div",{className:"flex flex-col justify-between pe-4",children:[e.jsx(W,{}),e.jsx(O,{})]}):e.jsx(D,{to:"/signin"})}export{Z as component};
