import{c as p,u as g,z as x,j as e,B as y,t as d,r as f,a as v,L as j,N as S}from"./main-Bv9S1MYm.js";import{u as h,a as b,s as N,e as C,b as F,D,c as T,i as w,T as E,d as k,C as I,f as r,g as z,h as H}from"./use-client-table-BcbZZ325.js";import{u as L,F as M,a as R,I as V,b as K}from"./field-CkNVEhos.js";import{C as B,a as A,b as U,c as _}from"./card-C8MFksr0.js";const O=[["path",{d:"M16 20V4a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16",key:"jecpp"}],["rect",{width:"20",height:"14",x:"2",y:"6",rx:"2",key:"i6l2r4"}]],q=p("briefcase",O);const Y=[["path",{d:"M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z",key:"1oefj6"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}],["path",{d:"M8 13h2",key:"yr2amv"}],["path",{d:"M14 13h2",key:"un5t4a"}],["path",{d:"M8 17h2",key:"2yhykz"}],["path",{d:"M14 17h2",key:"10kma7"}]],Q=p("file-spreadsheet",Y);function P(){const a=h(N),t=g(),n=L({defaultValues:{id:""},validators:{onSubmit:x.object({id:x.string().min(1)})},onSubmit:async({value:s})=>{d.promise(i({data:s}),{loading:"Scanning..."})}}),{mutateAsync:i}=b({mutationFn:a,onSuccess:s=>{t.invalidateQueries({queryKey:["haircut-history"]}),d.success(s.message),n.reset()},onError:s=>{d.error(s.message)}});return e.jsxs(B,{children:[e.jsx(A,{children:e.jsx(U,{children:"Scan Barcode"})}),e.jsx(_,{children:e.jsxs("form",{onSubmit:s=>{s.preventDefault(),n.handleSubmit()},className:"flex gap-2 items-center w-full",children:[e.jsx("div",{className:"flex-1",children:e.jsx(n.Field,{name:"id",children:s=>{const c=s.state.meta.isTouched&&!s.state.meta.isValid;return e.jsxs(M,{"data-invalid":c,children:[e.jsx(R,{htmlFor:s.name,children:"Instansi"}),e.jsx(V,{value:s.state.value,onChange:l=>{s.handleChange(l.target.value)},autoFocus:!0,placeholder:"Scan ID Barcode..."}),c&&e.jsx(K,{errors:s.state.meta.errors})]})}})}),e.jsx(n.Subscribe,{selector:s=>s.isSubmitting,children:s=>e.jsx(y,{type:"submit",disabled:s,className:"mt-7.5",children:s?"Scanning...":"Scan"})})]})})]})}function $(){return[{id:"no",accessorKey:"no",header:({column:a})=>e.jsx(r,{column:a,title:"No"}),cell:({row:a})=>e.jsx("div",{children:a.index+1}),minSize:40,maxSize:40,enableSorting:!1,enablePinning:!1,enableHiding:!1},{id:"name",accessorKey:"name",header:({column:a})=>e.jsx(r,{column:a,title:"Name"}),cell:({row:a})=>e.jsx("div",{children:a.getValue("name")}),meta:{label:"Name",placeholder:"Search Name...",variant:"text",icon:E},filterFn:w,enableColumnFilter:!0},{id:"position",accessorKey:"position",header:({column:a})=>e.jsx(r,{column:a,title:"Instansi"}),cell:({row:a})=>e.jsx("div",{children:a.getValue("position")}),meta:{label:"Instansi",placeholder:"Search instansi...",variant:"combobox",icon:q},enableColumnFilter:!0},{accessorKey:"badge",header:({column:a})=>e.jsx(r,{column:a,title:"Badge"}),cell:({row:a})=>e.jsx("div",{children:a.getValue("badge")})},{id:"haircutDate",accessorKey:"haircutDate",header:({column:a})=>e.jsx(r,{column:a,title:"Date"}),cell:({row:a})=>{const t=a.getValue("haircutDate");return t instanceof Date&&!Number.isNaN(t.getTime())?e.jsx("div",{children:t.toLocaleDateString("id-ID",{weekday:"long",day:"numeric",month:"long",year:"numeric"})}):e.jsx("div",{children:"-"})},meta:{label:"Haircut Date",placeholder:"Search Haircut Date...",variant:"dateRange",icon:I},filterFn:k,enableColumnFilter:!0,minSize:200,maxSize:200},{accessorKey:"formattedTime",header:({column:a})=>e.jsx(r,{column:a,title:"Time"}),cell:({row:a})=>e.jsx("div",{children:a.getValue("formattedTime")})},{accessorKey:"monthYear",header:({column:a})=>e.jsx(r,{column:a,title:"Month & Year"}),cell:({row:a})=>e.jsx("div",{children:a.getValue("monthYear")})}]}function G({data:a,username:t}){const n=h(C),{mutateAsync:i}=b({mutationFn:async()=>await(await n({})).blob(),onSuccess:o=>{const u=window.URL.createObjectURL(o),m=document.createElement("a");m.href=u,m.download=`haircut-history-${new Date().toISOString()}.xlsx`,m.click(),window.URL.revokeObjectURL(u)}}),s=()=>{d.promise(i(),{loading:"Exporting Excel...",success:"Excel exported successfully",error:"Failed to export Excel"})},c=f.useMemo(()=>$(),[]),{table:l}=F({defaultColumn:{minSize:160},data:a,columns:c,getRowId:o=>o.id});return e.jsx("div",{className:"w-full",children:e.jsx(D,{className:"py-3 mt-10",table:l,children:e.jsx(T,{table:l,children:t==="admin"&&e.jsxs(y,{variant:"outline",size:"sm",className:"h-8",onClick:s,children:["Export Excel",e.jsx(Q,{className:"ml-2 h-4 w-4"})]})})})})}function ee(){const a=h(H),{data:t,isLoading:n}=z({queryKey:["haircut-history"],queryFn:()=>a()}),{data:i,isPending:s}=v();return s?e.jsx("div",{className:"flex items-center justify-center h-screen",children:e.jsx(j,{className:"size-10 animate-spin"})}):i?e.jsxs("div",{className:"flex flex-col justify-between pe-5",children:[e.jsx(P,{}),n?e.jsx("div",{className:"flex items-center justify-center h-screen",children:e.jsx(j,{className:"size-10 animate-spin"})}):e.jsx(G,{username:i?.user.username||"",data:t?.data||[]})]}):e.jsx(S,{to:"/signin"})}export{ee as component};
