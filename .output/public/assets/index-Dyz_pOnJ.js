import{c as j,j as a,a as l,u as g,B as b,t as o,r as y}from"./main-DxtvtzDV.js";import{u as h,a as f,z as x,b as p,F as v,c as S,I as N,d as F,s as C,e as D,f as w,D as T,g as k,i as E,T as I,h as H,C as M,j as n,k as z,l as L}from"./use-client-table-BFvYZNK4.js";const R=[["path",{d:"M16 20V4a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16",key:"jecpp"}],["rect",{width:"20",height:"14",x:"2",y:"6",rx:"2",key:"i6l2r4"}]],V=j("briefcase",R);const K=[["path",{d:"M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z",key:"1oefj6"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}],["path",{d:"M8 13h2",key:"yr2amv"}],["path",{d:"M14 13h2",key:"un5t4a"}],["path",{d:"M8 17h2",key:"2yhykz"}],["path",{d:"M14 17h2",key:"10kma7"}]],B=j("file-spreadsheet",K);function _({className:e,...s}){return a.jsx("div",{"data-slot":"card",className:l("bg-card text-card-foreground flex flex-col gap-6 rounded-xl border py-6 shadow-sm",e),...s})}function A({className:e,...s}){return a.jsx("div",{"data-slot":"card-header",className:l("@container/card-header grid auto-rows-min grid-rows-[auto_auto] items-start gap-2 px-6 has-data-[slot=card-action]:grid-cols-[1fr_auto] [.border-b]:pb-6",e),...s})}function U({className:e,...s}){return a.jsx("div",{"data-slot":"card-title",className:l("leading-none font-semibold",e),...s})}function O({className:e,...s}){return a.jsx("div",{"data-slot":"card-content",className:l("px-6",e),...s})}function q(){const e=h(C),s=g(),r=f({defaultValues:{id:""},validators:{onSubmit:x.object({id:x.string().min(1)})},onSubmit:async({value:t})=>{o.promise(d({data:t}),{loading:"Scanning..."})}}),{mutateAsync:d}=p({mutationFn:e,onSuccess:t=>{s.invalidateQueries({queryKey:["haircut-history"]}),o.success(t.message),r.reset()},onError:t=>{o.error(t.message)}});return a.jsxs(_,{children:[a.jsx(A,{children:a.jsx(U,{children:"Scan Barcode"})}),a.jsx(O,{children:a.jsxs("form",{onSubmit:t=>{t.preventDefault(),r.handleSubmit()},className:"flex gap-2 items-center w-full",children:[a.jsx("div",{className:"flex-1",children:a.jsx(r.Field,{name:"id",children:t=>{const c=t.state.meta.isTouched&&!t.state.meta.isValid;return a.jsxs(v,{"data-invalid":c,children:[a.jsx(S,{htmlFor:t.name,children:"Instansi"}),a.jsx(N,{value:t.state.value,onChange:i=>{t.handleChange(i.target.value)},autoFocus:!0,placeholder:"Scan ID Barcode..."}),c&&a.jsx(F,{errors:t.state.meta.errors})]})}})}),a.jsx(r.Subscribe,{selector:t=>t.isSubmitting,children:t=>a.jsx(b,{type:"submit",disabled:t,className:"mt-7.5",children:t?"Scanning...":"Scan"})})]})})]})}function Y(){return[{id:"no",accessorKey:"no",header:({column:e})=>a.jsx(n,{column:e,title:"No"}),cell:({row:e})=>a.jsx("div",{children:e.index+1}),minSize:40,maxSize:40,enableSorting:!1,enablePinning:!1,enableHiding:!1},{id:"name",accessorKey:"name",header:({column:e})=>a.jsx(n,{column:e,title:"Name"}),cell:({row:e})=>a.jsx("div",{children:e.getValue("name")}),meta:{label:"Name",placeholder:"Search Name...",variant:"text",icon:I},filterFn:E,enableColumnFilter:!0},{id:"position",accessorKey:"position",header:({column:e})=>a.jsx(n,{column:e,title:"Instansi"}),cell:({row:e})=>a.jsx("div",{children:e.getValue("position")}),meta:{label:"Instansi",placeholder:"Search instansi...",variant:"combobox",icon:V},enableColumnFilter:!0},{accessorKey:"badge",header:({column:e})=>a.jsx(n,{column:e,title:"Badge"}),cell:({row:e})=>a.jsx("div",{children:e.getValue("badge")})},{id:"haircutDate",accessorKey:"haircutDate",header:({column:e})=>a.jsx(n,{column:e,title:"Date"}),cell:({row:e})=>{const s=e.getValue("haircutDate");return s instanceof Date&&!Number.isNaN(s.getTime())?a.jsx("div",{children:s.toLocaleDateString("id-ID",{weekday:"long",day:"numeric",month:"long",year:"numeric"})}):a.jsx("div",{children:"-"})},meta:{label:"Haircut Date",placeholder:"Search Haircut Date...",variant:"dateRange",icon:M},filterFn:H,enableColumnFilter:!0,minSize:200,maxSize:200},{accessorKey:"formattedTime",header:({column:e})=>a.jsx(n,{column:e,title:"Time"}),cell:({row:e})=>a.jsx("div",{children:e.getValue("formattedTime")})},{accessorKey:"monthYear",header:({column:e})=>a.jsx(n,{column:e,title:"Month & Year"}),cell:({row:e})=>a.jsx("div",{children:e.getValue("monthYear")})}]}function Q({data:e}){const s=h(D),{mutateAsync:r}=p({mutationFn:async()=>await(await s({})).blob(),onSuccess:i=>{const u=window.URL.createObjectURL(i),m=document.createElement("a");m.href=u,m.download=`haircut-history-${new Date().toISOString()}.xlsx`,m.click(),window.URL.revokeObjectURL(u)}}),d=()=>{o.promise(r(),{loading:"Exporting Excel...",success:"Excel exported successfully",error:"Failed to export Excel"})},t=y.useMemo(()=>Y(),[]),{table:c}=w({defaultColumn:{minSize:160},data:e,columns:t,getRowId:i=>i.id});return a.jsx("div",{className:"w-full",children:a.jsx(T,{className:"py-3 mt-10",table:c,children:a.jsx(k,{table:c,children:a.jsxs(b,{variant:"outline",size:"sm",className:"h-8",onClick:d,children:["Export Excel",a.jsx(B,{className:"ml-2 h-4 w-4"})]})})})})}function G(){const e=h(L),{data:s,isLoading:r}=z({queryKey:["haircut-history"],queryFn:()=>e()});return a.jsxs("div",{className:"flex flex-col justify-between pe-5",children:[a.jsx(q,{}),r?a.jsx("div",{children:"Loading..."}):a.jsx(Q,{data:s?.data||[]})]})}export{G as component};
